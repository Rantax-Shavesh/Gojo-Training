<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shadow Training - Gojo Theme</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getDatabase, ref, get, set, update, onValue } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAaU9NsFtO2MPuWBwBHEjlqh4fDJhBKcoU",
      authDomain: "gojo-training-website.firebaseapp.com",
      projectId: "gojo-training-website",
      storageBucket: "gojo-training-website.appspot.com",
      messagingSenderId: "891184046270",
      appId: "1:891184046270:web:a26debfbbae9ffd5a87eef",
      measurementId: "G-6SL7013P7P",
      databaseURL: "https://gojo-training-website-default-rtdb.asia-southeast1.firebasedatabase.app"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let username = localStorage.getItem('username') || prompt("Enter your username:");
    localStorage.setItem('username', username);
    document.title = `Training - ${username}`;

    let xp = 0, level = 1;
    let stats = { STR: 0, STA: 0, COM: 0, INT: 0 };
    let exerciseProgress = { pushups: 0, squats: 0, crunches: 0, forearm: 0, punches: 0, kicks: 0, running: 0, meditate: 0, dodge: 0 };

    const titles = ["Student", "First Grade", "Semi Grade 1", "Grade 1", "Special Grade", "Domain User", "Six Eyes", "Hollow Purple Master", "Limitless User", "Gojo-Level", "Ascended"];

    function getTitle(level) {
      if (level >= 100) return "Ascended";
      if (level >= 90) return "Gojo-Level";
      if (level >= 80) return "Limitless User";
      if (level >= 70) return "Hollow Purple Master";
      if (level >= 60) return "Six Eyes";
      if (level >= 50) return "Domain User";
      if (level >= 40) return "Special Grade";
      if (level >= 30) return "Grade 1";
      if (level >= 20) return "Semi Grade 1";
      if (level >= 10) return "First Grade";
      return "Student";
    }

    function updateUI() {
      document.getElementById("stat-str").textContent = stats.STR;
      document.getElementById("stat-sta").textContent = stats.STA;
      document.getElementById("stat-com").textContent = stats.COM;
      document.getElementById("stat-int").textContent = stats.INT;

      document.getElementById("xpDisplay").textContent = `XP: ${xp.toFixed(1)} | Level: ${level} | Title: ${getTitle(level)}`;
      document.getElementById("xpBar").style.width = `${(xp / (level * 100)) * 100}%`;
    }

    function saveData() {
      set(ref(db, 'users/' + username), {
        username,
        level,
        xp,
        stats,
        exerciseProgress,
        title: getTitle(level)
      });
    }

    function loadData() {
      const userRef = ref(db, 'users/' + username);
      get(userRef).then(snapshot => {
        if (snapshot.exists()) {
          const data = snapshot.val();
          xp = data.xp || 0;
          level = data.level || 1;
          stats = data.stats || stats;
          exerciseProgress = data.exerciseProgress || exerciseProgress;
        }
        updateUI();
      });
    }

    window.submitTraining = function () {
      const inputs = ['pushups', 'squats', 'crunches', 'forearm', 'punches', 'kicks', 'running', 'meditate', 'dodge', 'plank'];
      let gainedXP = 0;

      inputs.forEach(key => {
        const value = parseInt(document.getElementById(key).value) || 0;
        gainedXP += value * 0.1;
        if (key !== 'plank') {
          exerciseProgress[key] += value;
        }
      });

      function updateStat(key, required, statKey) {
        while (exerciseProgress[key] >= required) {
          stats[statKey]++;
          exerciseProgress[key] -= required;
        }
      }

      updateStat('pushups', 100, 'STR');
      updateStat('squats', 100, 'STR');
      updateStat('crunches', 100, 'STR');
      updateStat('forearm', 100, 'STR');
      updateStat('punches', 100, 'COM');
      updateStat('kicks', 100, 'COM');
      updateStat('running', 100, 'STA');
      updateStat('dodge', 100, 'COM');
      updateStat('meditate', 10, 'INT');

      xp += gainedXP;
      while (xp >= level * 100) {
        xp -= level * 100;
        level++;
      }

      saveData();
      updateUI();
    }

    function loadLeaderboard() {
      const lbRef = ref(db, 'users');
      onValue(lbRef, snapshot => {
        const container = document.createElement("div");
        container.className = 'section';
        const list = document.createElement("ol");
        const users = [];

        snapshot.forEach(child => {
          users.push(child.val());
        });

        users.sort((a, b) => b.level - a.level);

        users.forEach(user => {
          const item = document.createElement("li");
          item.textContent = `${user.username} | ${user.title || getTitle(user.level)} | Level ${user.level}`;
          list.appendChild(item);
        });

        container.appendChild(document.createElement("h2")).textContent = "Leaderboard";
        container.appendChild(list);
        document.body.appendChild(container);
      });
    }

    window.onload = () => {
      loadData();
      loadLeaderboard();
    }
  </script>
  <style>
    /* [Your CSS stays unchanged] */
  </style>
</head>
<body>
  <div id="mainContent" class="active">
    <h1>Six Eyes Training</h1>
    <div class="stats">
      <div class="stat"><h3>STR</h3><p id="stat-str">0</p></div>
      <div class="stat"><h3>STA</h3><p id="stat-sta">0</p></div>
      <div class="stat"><h3>COM</h3><p id="stat-com">0</p></div>
      <div class="stat"><h3>INT</h3><p id="stat-int">0</p></div>
    </div>
    <div class="section">
      <div id="xpBarContainer"><div id="xpBar"></div></div>
      <p id="xpDisplay" style="text-align:center; font-size:1.2em;">XP: 0 | Level: 1 | Title: Student</p>
    </div>
    <div class="section">
      <h2>Today's Training Log</h2>
      <div class="exercise-log">
        <label>Push-ups (100 for +1 STR)</label><input type="text" id="pushups" />
        <label>Squats (100 for +1 STR)</label><input type="text" id="squats" />
        <label>Crunches (100 for +1 STR)</label><input type="text" id="crunches" />
        <label>Forearm Training (100 for +1 STR)</label><input type="text" id="forearm" />
        <label>Punches (100 for +1 COM)</label><input type="text" id="punches" />
        <label>Kicks (100 for +1 COM)</label><input type="text" id="kicks" />
        <label>1 km Running (100 for +1 STA)</label><input type="text" id="running" />
        <label>10 min Meditate (10 for +1 INT)</label><input type="text" id="meditate" />
        <label>10 min Dodge (100 for +1 COM)</label><input type="text" id="dodge" />
        <label>Plank (XP Only)</label><input type="text" id="plank" />
      </div>
      <button onclick="submitTraining()">Submit Training</button>
    </div>
  </div>
</body>
</html>
