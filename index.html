<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shadow Warrior Training</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Orbitron', sans-serif;
      background: #0d0d0d;
      color: #fff;
      overflow: hidden;
    }

    #purpleAnimation {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: radial-gradient(circle, #a64dff 0%, #1a0033 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      animation: fadeOut 4s forwards;
      z-index: 1000;
    }

    @keyframes fadeOut {
      0% { opacity: 1; }
      80% { opacity: 1; }
      100% { opacity: 0; display: none; }
    }

    #usernameInputPage, #mainContent {
      display: none;
      padding: 2rem;
    }

    h1, h2 {
      text-align: center;
    }

    .section {
      margin: 1.5rem 0;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 1rem;
      text-align: center;
    }

    .card {
      background: #1a1a1a;
      padding: 1rem;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
    }

    input, button {
      font-family: inherit;
      padding: 0.5rem 1rem;
      margin: 0.5rem 0;
      border-radius: 8px;
      border: none;
    }
  </style>
</head>
<body>
  <div id="purpleAnimation">Hollow Purple!</div>
  <div id="usernameInputPage">
    <h1>Enter Your Shadow Warrior Name</h1>
    <input type="text" id="usernameInput" placeholder="Enter username...">
    <button onclick="saveUsername()">Start</button>
  </div>
  <div id="mainContent">
    <h1>Welcome, <span id="displayUsername"></span></h1>
    <div class="section">
      <h2>Stats</h2>
      <div class="stats-grid">
        <div class="card">Level: <span id="level">1</span></div>
        <div class="card">XP: <span id="xp">0</span></div>
        <div class="card">STR: <span id="statSTR">0</span></div>
        <div class="card">STA: <span id="statSTA">0</span></div>
        <div class="card">COM: <span id="statCOM">0</span></div>
        <div class="card">INT: <span id="statINT">0</span></div>
      </div>
      <div class="card" style="margin-top:1rem; text-align:center;">
        Title: <span id="title">Rookie</span>
      </div>
    </div>

    <div class="section">
      <h2>Train</h2>
      <form onsubmit="submitTraining(); return false;">
        <input type="number" id="pushups" placeholder="Pushups">
        <input type="number" id="crunches" placeholder="Crunches">
        <input type="number" id="squats" placeholder="Squats">
        <input type="number" id="burpees" placeholder="Burpees">
        <input type="number" id="combos" placeholder="Combos">
        <button type="submit">Train</button>
      </form>
    </div>

    <div class="section">
      <h2>Leaderboard</h2>
      <ul id="leaderboardList" style="list-style:none; padding:0;"></ul>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getDatabase, ref, set, get, onValue } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MSG_ID",
      appId: "YOUR_APP_ID",
      databaseURL: "YOUR_DATABASE_URL"
    };

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    let xp = 0, level = 1;
    let stats = { STR: 0, STA: 0, COM: 0, INT: 0 };

    function saveUsername() {
      const name = document.getElementById('usernameInput').value.trim();
      if (!name) return;
      localStorage.setItem('username', name);
      location.reload();
    }

    function getTitle(lv) {
      if (lv < 5) return "Rookie";
      if (lv < 10) return "Apprentice";
      if (lv < 20) return "Shadow Fighter";
      if (lv < 40) return "Elite";
      if (lv < 70) return "Demon Slayer";
      return "Shadow Monarch";
    }

    function updateUI() {
      document.getElementById('xp').textContent = xp;
      document.getElementById('level').textContent = level;
      document.getElementById('statSTR').textContent = stats.STR;
      document.getElementById('statSTA').textContent = stats.STA;
      document.getElementById('statCOM').textContent = stats.COM;
      document.getElementById('statINT').textContent = stats.INT;
      document.getElementById('title').textContent = getTitle(level);
    }

    function submitTraining() {
      const p = parseInt(document.getElementById('pushups').value) || 0;
      const c = parseInt(document.getElementById('crunches').value) || 0;
      const s = parseInt(document.getElementById('squats').value) || 0;
      const b = parseInt(document.getElementById('burpees').value) || 0;
      const co = parseInt(document.getElementById('combos').value) || 0;

      const total = p + c + s + b + co;
      xp += total;
      stats.STR += p + s;
      stats.STA += b;
      stats.COM += co;
      stats.INT += c;
      level = Math.floor(xp / 100) + 1;

      updateUI();

      const username = localStorage.getItem('username') || 'Unknown';
      set(ref(database, 'users/' + username), {
        username: username,
        level: level,
        xp: xp,
        stats: stats,
        title: getTitle(level)
      });
    }

    function loadUserData() {
      const username = localStorage.getItem('username');
      if (!username) return;

      const userRef = ref(database, 'users/' + username);
      get(userRef).then(snapshot => {
        if (snapshot.exists()) {
          const data = snapshot.val();
          xp = data.xp || 0;
          level = data.level || 1;
          stats = data.stats || { STR: 0, STA: 0, COM: 0, INT: 0 };
          updateUI();
        }
      });
    }

    function loadLeaderboard() {
      const leaderboardRef = ref(database, 'users');
      onValue(leaderboardRef, snapshot => {
        const list = document.getElementById("leaderboardList");
        list.innerHTML = "";
        const users = [];

        snapshot.forEach(child => {
          const data = child.val();
          users.push(data);
        });

        users.sort((a, b) => b.level - a.level);

        users.forEach(user => {
          const li = document.createElement("li");
          li.textContent = `${user.username} | ${user.title} | Level ${user.level}`;
          list.appendChild(li);
        });
      });
    }

    window.onload = () => {
      const animation = document.getElementById("purpleAnimation");
      setTimeout(() => {
        animation.style.display = "none";
        const name = localStorage.getItem('username');
        if (!name) {
          document.getElementById("usernameInputPage").style.display = 'block';
        } else {
          document.getElementById("mainContent").style.display = 'block';
          document.getElementById("displayUsername").textContent = name;
          loadUserData();
          loadLeaderboard();
          updateUI();
        }
      }, 4000);
    }
  </script>
</body>
</html>
